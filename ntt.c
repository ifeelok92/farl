#include "inttypes.h"
#include "ntt.h"
#include "params.h"

static const int64_t qinv = 4191148031; 
static const int rlog = 32;

const int32_t zetas[N] = {
  405464, 943923, 547921, 150027, 411551, 442856, 382994, 195965, 237083, 935238, 227096, 301420, 559221, 802505, 35593, 489231, 68896, 511761, 153477, 735568, 141491, 51198, 139179, 113238, 44792, 238793, 321266, 907446, 233657, 585249, 1031765, 499710, 242732, 11188, 306882, 747310, 623345, 181223, 124244, 499631, 928002, 740331, 318879, 648141, 889103, 415263, 623817, 542215, 474481, 105114, 470221, 542784, 1013938, 539749, 894447, 261084, 292202, 149602, 5855, 166245, 775188, 353444, 908859, 125854, 680798, 881480, 704106, 651250, 153970, 355867, 1011516, 130483, 128894, 694618, 1011177, 962345, 792407, 200377, 242388, 821627, 813300, 6208, 296873, 642233, 247134, 597266, 649548, 933203, 118825, 332465, 854810, 304327, 497058, 688522, 551064, 741146, 129206, 370074, 552385, 378748, 75785, 747267, 593029, 912084, 172017, 220103, 565179, 994729, 366728, 901910, 817, 800842, 49366, 938820, 198016, 305692, 390717, 682149, 1013847, 980520, 772145, 190785, 724347, 363198, 385802, 390080, 467076, 566098, 665405, 759198, 336157, 540198, 345937, 910106, 515191, 90564, 806007, 324065, 637766, 915224, 125197, 14172, 111050, 246484, 476195, 1011229, 53104, 964265, 471674, 122951, 950387, 85761, 584369, 149243, 9929, 800646, 292909, 479138, 457166, 677529, 49977, 649367, 1030110, 677056, 804422, 801333, 705446, 162592, 764223, 97970, 499231, 238590, 330800, 15675, 516270, 352632, 944538, 152891, 922991, 867610, 288269, 326997, 517724, 144751, 541499, 254090, 350134, 617841, 77577, 533909, 61214, 408913, 874920, 285662, 20772, 118064, 966458, 620993, 851735, 627563, 48928, 515837, 442729, 705644, 318471, 353696, 541569, 554012, 428291, 521807, 48150, 712764, 37631, 499215, 787543, 334490, 529111, 546987, 728432, 214060, 96686, 172040, 529254, 744350, 544813, 747206, 162768, 256311, 652653, 738505, 903600, 644224, 965849, 296013, 1028413, 259114, 361258, 308562, 909143, 96676, 326227, 565937, 105569, 436675, 200098, 296531, 273428, 908475, 562586, 683466, 651825, 721202, 824808, 96211, 467131, 801751, 271467, 605403, 730746, 575924, 896774, 263313, 925161, 820159, 376997, 44309, 315695, 712023, 481027, 324674, 269317, 738546, 696750, 76175, 596165, 19539, 495145, 175776, 275719, 548791, 306132, 648871, 714693, 740817, 768620, 662625, 396641, 936364, 754145, 943260, 995075, 86623, 275771, 148588, 445423, 618982, 467753, 767096, 246529, 81757, 572705, 221512, 69067, 413758, 968024, 269985, 545754, 833334, 776909, 666549, 907433, 38369, 349149, 550858, 797303, 618706, 865961, 526067, 69222, 39534, 844891, 584864, 35397, 480119, 749842, 573690, 746447, 564191, 292124, 230738, 120553, 52560, 435175, 735890, 42446, 362824, 753683, 625114, 556231, 451595, 498266, 257299, 345533, 425132, 900294, 808387, 807611, 758874, 73883, 489319, 674245, 216593, 454671, 370822, 500512, 743145, 548461, 387037, 229732, 381586, 1029983, 755914, 969239, 284089, 58651, 226188, 522156, 859367, 925271, 253128, 713912, 301888, 552428, 147651, 253595, 452635, 561888, 184824, 586640, 742204, 311410, 4241, 567933, 126806, 423216, 582539, 828242, 65142, 452228, 702249, 791533, 816652, 198950, 984830, 630346, 273602, 186464, 234834, 380655, 765323, 270205, 1012925, 696195, 813233, 560599, 61327, 432048, 420992, 97663, 620081, 104301, 610822, 21932, 934852, 789691, 815780, 1027272, 354403, 30285, 1005323, 1033864, 978722, 187723, 229793, 634593, 195567, 1022941, 280199, 270421, 69392, 618186, 89716, 776048, 923189, 655953, 340967, 346841, 422369, 650192, 369807, 586526, 461427, 831692, 310294, 150863, 126661, 734747, 274547, 149100, 256605, 318701, 300817, 28837, 408242, 992723, 1015616, 677112, 455832, 160540, 470590, 513200, 697291, 749459, 386360, 552565, 111639, 824235, 133144, 978314, 748365, 31031, 255954, 855143, 277427, 82409, 885691, 1004257, 386349, 194155, 168576, 349545, 378553, 135118, 157539, 675251, 581220, 154842, 354025, 999495, 334489, 1019841, 496320, 676648, 752119, 789598, 832647, 706780, 478896, 809881, 101546, 101319, 917191, 53005, 747757, 80920, 943611, 1002661, 608819, 958441, 121141, 473451, 883661, 160597, 91810, 132398, 963471, 957994, 905601, 332038, 751327, 946100, 1030749, 676140, 29214, 574361, 256118, 509335, 750704, 718680, 587123, 377084, 832404, 883592, 476916, 580720, 297460, 676067, 131773, 552366, 505008, 497294, 869018, 177405, 46779, 647782, 427291, 744736, 293932, 667909, 896799, 700909, 36430, 82833, 418020, 239669, 801174, 178749, 405929, 729741, 423249, 895128, 271553, 337068, 497788, 957079, 100203, 878813, 975220, 898330, 907796, 767005, 1011355, 830939, 614336, 690111, 911819, 925893, 218473, 864230, 170116, 441667, 931749, 639797, 479881, 271722, 659639, 595388, 428418, 1009954, 290962, 602718, 684426, 631926, 813248, 471894, 27226, 186107, 366571, 985491, 764164, 1029357, 981098, 878051, 410031, 737704, 899400, 544131, 524785, 312594, 716192, 717182, 814149, 582802, 288299, 849861, 74249, 729150, 798394, 316522, 517374, 277866, 818129, 107027, 38265, 236924, 461654, 1020008, 588846, 305414, 64537, 945158, 732669, 432306, 72747, 400790, 853773, 699886, 221967, 963410, 436911, 986084, 812923, 426413, 159022, 669256, 853468, 1036453, 442177, 714880, 919035, 480386, 485589, 825752, 818195, 10832, 100957, 81325, 602200, 726602, 679938, 527411, 531526, 938594, 851321, 753738, 860767, 262362, 12589, 990947, 466858, 703537, 497654, 316965, 961780, 998937, 435691, 507245, 102586, 1433, 532812, 432861, 374026, 1022367, 105180, 762983, 1015088, 139465, 507964, 172375, 300318, 464729, 478177, 383107, 264790, 329939, 272315, 329453, 59006, 180726, 985222, 817554, 373500, 750675, 612416, 397450, 41590, 644458, 929666, 967221, 359797, 475226, 182130, 179546, 82742, 888964, 27371, 186221, 647348, 338623, 930319, 35923, 864812, 77628, 960091, 776313, 1020271, 372770, 208036, 783299, 10044, 935925, 6761, 205822, 732163, 802032, 944509, 763587, 280308, 555868, 349957, 353909, 178814, 1182, 288047, 887442, 359234, 776630, 717150, 599633, 964816, 727315, 204512, 163920, 415820, 331158, 95890, 254413, 427092, 515610, 639807, 1015176, 237064, 245441, 1027132, 62800, 143597, 970615, 157344, 258719, 394181, 200722, 685780, 145313, 228882, 748999, 492118, 584768, 612794, 860902, 863020, 714317, 998814, 1015406, 184185, 938931, 633892, 222340, 482935, 487101, 183242, 815731, 246368, 646486, 896804, 174453, 481686, 1008868, 621904, 43121, 139918, 150980, 4957, 562700, 964243, 822543, 774962, 203541, 96356, 13760, 809224, 106852, 326797, 264091, 982973, 741081, 208774, 134030, 64577, 886858, 141369, 18053, 97611, 503305, 872991, 51691, 517145, 612993, 60200, 262158, 384535, 761386, 1025606, 616999, 818583, 483659, 595369, 625624, 393126, 180879, 187094, 888112, 114905, 217388, 655338, 937727, 874586, 368741, 804779, 90458, 899648, 182671, 1012073, 895952, 479385, 616332, 660431, 606433, 1026660, 925004, 770479, 333640, 762232, 67450, 338584, 376692, 814180, 151841, 786654, 203138, 861671, 1021456, 147590, 982300, 382719, 293195, 873864, 414922, 557192, 910531, 436681, 763409, 971321, 72142, 90522, 722815, 652215, 1032498, 109976, 923738, 330193, 12902, 663383, 299567, 555571, 677296, 1036531, 409435, 514008, 512654, 226906, 56659, 620963, 895460, 32701, 104025, 258942, 546703, 538404, 545033, 651481, 25629, 576961, 93397, 824376, 866226, 623149, 754879, 765478, 528090, 118091, 333809, 240325, 165050, 65733, 796418, 980183, 654158, 956806, 627159, 739965, 852324, 866851, 452374, 497131, 709962, 1029447, 64723, 699189, 59798, 364274, 121693, 783656, 1030417, 331089, 943599, 490667, 786209, 18186, 787680, 298478, 31518, 681215, 1036305, 223391, 964604, 153371, 34650, 1017536, 724853, 662199, 842034, 388471, 216351, 988558, 662636, 524515, 254588, 138560, 443027, 528783, 264000, 385407, 775632, 1009802, 575451, 772984, 740762, 87991, 1026074, 828472, 443683, 432137, 950050, 303190, 921674, 1142, 412209, 770114, 727205, 771543, 514217, 278379, 103567, 788604, 48729, 909206, 199236, 341219, 555899, 690447, 103383, 207905, 692035, 641026, 382243, 923911, 641975, 51372, 176187, 435156, 184037, 842482, 812745, 743266, 713633, 352489, 217150, 50938, 518129, 841677, 955331, 294416, 760198, 504184};

const int32_t omegas_inv_bitrev_montgomery[N/2] = {
  405464, 94414, 888310, 490416, 842372, 655343, 595481, 626786, 549106, 1002744, 235832, 479116, 736917, 811241, 103099, 801254, 538627, 6572, 453088, 804680, 130891, 717071, 799544, 993545, 925099, 899158, 987139, 896846, 302769, 884860, 526576, 969441, 912483, 129478, 684893, 263149, 872092, 1032482, 888735, 746135, 777253, 143890, 498588, 24399, 495553, 568116, 933223, 563856, 496122, 414520, 623074, 149234, 390196, 719458, 298006, 110335, 538706, 914093, 857114, 414992, 291027, 731455, 1027149, 795605, 472239, 571261, 648257, 652535, 675139, 313990, 847552, 266192, 57817, 24490, 356188, 647620, 732645, 840321, 99517, 988971, 237495, 1037520, 136427, 671609, 43608, 473158, 818234, 866320, 126253, 445308, 291070, 962552, 659589, 485952, 668263, 909131, 297191, 487273, 349815, 541279, 734010, 183527, 705872, 919512, 105134, 388789, 441071, 791203, 396104, 741464, 1032129, 225037, 216710, 795949, 837960, 245930, 75992, 27160, 343719, 909443, 907854, 26821, 682470, 884367, 387087, 334231, 156857, 357539, 236586, 571206, 942126, 213529, 317135, 386512, 354871, 475751, 129862, 764909, 741806, 838239, 601662, 932768, 472400, 712110, 941661, 129194, 729775, 677079, 779223, 9924, 742324, 72488, 394113, 134737, 299832, 385684, 782026, 875569, 291131, 493524, 293987, 509083, 866297, 941651, 824277, 309905, 491350, 509226, 703847, 250794, 539122, 1000706, 325573, 990187, 516530, 610046, 484325, 496768, 684641, 719866, 332693, 595608, 522500, 989409, 410774, 186602, 417344, 71879, 920273, 1017565, 752675, 163417, 629424, 977123, 504428, 960760, 420496, 688203, 784247, 496838, 893586, 520613, 711340, 750068, 170727, 115346, 885446, 93799, 685705, 522067, 1022662, 707537, 799747, 539106, 940367, 274114, 875745, 332891, 237004, 233915, 361281, 8227, 388970, 988360, 360808, 581171, 559199, 745428, 237691, 1028408, 889094, 453968, 952576, 87950, 915386, 566663, 74072, 985233, 27108, 562142, 791853, 927287, 1024165, 913140, 123113, 400571, 714272, 232330, 947773, 523146, 128231, 692400, 498139, 702180, 279139, 372932, 154676, 564886, 917196, 79896, 429518, 35676, 94726, 957417, 290580, 985332, 121146, 937018, 936791, 228456, 559441, 331557, 205690, 248739, 286218, 361689, 542017, 18496, 703848, 38842, 684312, 883495, 457117, 363086, 880798, 903219, 659784, 688792, 869761, 844182, 651988, 34080, 152646, 955928, 760910, 183194, 782383, 1007306, 289972, 60023, 905193, 214102, 926698, 485772, 651977, 288878, 341046, 525137, 567747, 877797, 582505, 361225, 22721, 45614, 630095, 1009500, 737520, 719636, 781732, 889237, 763790, 303590, 911676, 887474, 728043, 206645, 576910, 451811, 668530, 388145, 615968, 691496, 697370, 382384, 115148, 262289, 948621, 420151, 968945, 767916, 758138, 15396, 842770, 403744, 808544, 850614, 59615, 4473, 33014, 1008052, 683934, 11065, 222557, 248646, 103485, 1016405, 427515, 934036, 418256, 940674, 617345, 606289, 977010, 477738, 225104, 342142, 25412, 768132, 273014, 657682, 803503, 851873, 764735, 407991, 53507, 839387, 221685, 246804, 336088, 586109, 973195, 210095, 455798, 615121, 911531, 470404, 1034096, 726927, 296133, 451697, 853513, 476449, 585702, 784742, 890686, 485909, 736449, 324425, 785209, 113066, 178970, 516181, 812149, 979686, 754248, 69098, 282423, 8354, 656751, 808605, 651300, 489876, 295192, 537825, 667515, 583666, 821744, 364092, 549018, 964454, 279463, 230726, 229950, 138043, 613205, 692804, 781038, 540071, 586742, 482106, 413223, 284654, 675513, 995891, 302447, 603162, 985777, 917784, 807599, 746213, 474146, 291890, 464647, 288495, 558218, 1002940, 453473, 193446, 998803, 969115, 512270, 172376, 419631, 241034, 487479, 689188, 999968, 130904, 371788, 261428, 205003, 492583, 768352, 70313, 624579, 969270, 816825, 465632, 956580, 791808, 271241, 570584, 419355, 592914, 889749, 762566, 951714, 43262, 95077, 284192, 101973, 641696, 375712, 269717, 297520, 323644, 389466, 732205, 489546, 762618, 862561, 543192, 1018798, 442172, 962162, 341587, 299791, 769020, 713663, 557310, 326314, 722642, 994028, 661340, 218178, 113176, 775024, 141563, 462413, 307591, 432934, 766870};

const int32_t psis_inv_montgomery[N] = {
  40956, 380772, 985760, 681255, 995980, 245390, 865833, 696192, 861348, 704084, 116342, 64298, 341319, 589147, 630670, 464536, 938842, 886979, 648796, 385412, 938238, 672966, 536195, 503446, 804393, 394526, 684668, 1027711, 673649, 663020, 433078, 708741, 1035821, 174358, 136077, 746105, 425786, 462972, 233395, 382241, 74254, 341395, 636705, 60344, 380920, 914425, 62464, 341305, 525737, 899678, 315991, 533470, 27851, 951361, 332238, 398848, 383504, 454723, 399783, 613372, 733896, 901267, 244667, 112835, 793485, 235918, 239588, 842010, 188731, 413605, 26936, 515411, 558771, 257905, 144641, 968105, 371997, 549750, 487697, 376256, 1001578, 86908, 991443, 166093, 674998, 988006, 173993, 262894, 342835, 335519, 129381, 381447, 779683, 616272, 963779, 506710, 606262, 274120, 755085, 306961, 129163, 135732, 666840, 528222, 733246, 330573, 422614, 336128, 811042, 101306, 492200, 598225, 955715, 324345, 842657, 894171, 886638, 735982, 1004324, 657618, 440963, 970367, 530539, 844231, 458240, 605892, 971626, 744557, 386143, 985801, 570288, 59837, 309580, 866323, 838868, 791101, 711474, 805981, 22005, 134914, 373563, 819254, 212336, 675351, 361836, 66172, 967506, 625632, 44407, 436282, 90519, 436634, 201489, 199694, 524656, 305202, 913847, 411214, 470787, 177971, 183662, 1402, 713372, 354200, 42335, 396635, 446897, 257051, 429979, 764201, 655785, 742146, 1036076, 142655, 872975, 410902, 985990, 387986, 581577, 757432, 108823, 1015389, 340653, 390986, 819387, 814731, 196449, 215508, 802195, 822526, 347107, 549560, 368802, 763734, 172281, 667119, 456888, 415652, 843354, 46069, 547262, 788875, 1012654, 1006436, 285101, 57660, 832695, 125250, 64366, 55975, 24206, 610505, 60144, 365066, 10713, 610402, 186963, 564190, 178684, 1364, 689593, 639363, 84143, 928012, 339986, 929965, 878985, 783481, 315104, 224340, 754705, 69171, 904119, 553812, 788925, 497449, 194027, 667285, 615414, 44329, 824667, 402607, 795697, 909665, 308141, 430369, 898950, 133682, 1023505, 610207, 638757, 306073, 557173, 733467, 441542, 922814, 530176, 535105, 313208, 240178, 992613, 570340, 147026, 793746, 973060, 712863, 718803, 774332, 410149, 542115, 765057, 972841, 165951, 476841, 304837, 2327, 7944, 380520, 882717, 331714, 398844, 217053, 976584, 950677, 942553, 340097, 97711, 674476, 552059, 265780, 509308, 209970, 342431, 137360, 920492, 989880, 800180, 299379, 794909, 307265, 319395, 969439, 332376, 430554, 550197, 138946, 983914, 181888, 421479, 90406, 666494, 147760, 706563, 219402, 342503, 18467, 872027, 418821, 66607, 119402, 722199, 877399, 720059, 84759, 603041, 963678, 197586, 25287, 166644, 500625, 487322, 606114, 345455, 335539, 961636, 887153, 101887, 8704, 856100, 371142, 533891, 154674, 278599, 1016685, 277253, 556953, 923695, 70461, 71874, 983402, 681237, 766119, 1036259, 229845, 620001, 646758, 203093, 492977, 1002469, 562489, 781065, 497389, 812273, 188504, 572128, 828696, 109367, 809311, 1012810, 229666, 699262, 377871, 454680, 946693, 252940, 945153, 546199, 424260, 819641, 481831, 804228, 537197, 146773, 389506, 494400, 772619, 513177, 527049, 463745, 471188, 510876, 43531, 325308, 161008, 635328, 646875, 139684, 24845, 983043, 538562, 99226, 119651, 959988, 839583, 172860, 619566, 456525, 106526, 698322, 718692, 568249, 614658, 773537, 814381, 687873, 710686, 203581, 33259, 673984, 845326, 77789, 777365, 204090, 706993, 980324, 831812, 1020908, 269359, 699565, 266906, 120931, 230784, 1016320, 404070, 153683, 833428, 775207, 219926, 342507, 184918, 350166, 906264, 775763, 513201, 487418, 447590, 280835, 612464, 329651, 993296, 697165, 76658, 698094, 576018, 202553, 865506, 846788, 172915, 572009, 289711, 319261, 65847, 682159, 195437, 675222, 964229, 23213, 562940, 598765, 583186, 480026, 193894, 64890, 55979, 190657, 88644, 547587, 35885, 404512, 375621, 795491, 124966, 706389, 766311, 719211, 100605, 135514, 421125, 415379, 645196, 100040, 246477, 152480, 873050, 157263, 286545, 961262, 379871, 613220, 638780, 1003582, 411899, 161669, 365841, 850900, 997275, 919130, 902681, 419055, 978126, 221475, 683347, 829545, 394718, 367620, 898471, 189162, 437387, 645364, 860960, 133392, 896683, 545829, 83429, 809113, 561013, 622529, 971753, 578107, 170864, 627477, 242577, 881664, 902395, 458684, 391887, 153590, 857206, 188847, 48999, 468022, 114540, 357555, 256369, 604351, 963688, 94545, 278140, 866083, 196841, 952651, 538330, 828438, 275816, 723393, 203678, 175932, 738483, 465359, 661430, 203205, 1000257, 927079, 712512, 909030, 102054, 468427, 613896, 733900, 29381, 761143, 600278, 464304, 629717, 4807, 412201, 787844, 941310, 791883, 545029, 20013, 309276, 676091, 5161, 87228, 809142, 989030, 213632, 611951, 527803, 170480, 223236, 501057, 812301, 315324, 34112, 87449, 920111, 450893, 407680, 336014, 739705, 956795, 617624, 115682, 634982, 266413, 113001, 952011, 902932, 220901, 160211, 437166, 534395, 360760, 977681, 134283, 333927, 335451, 414725, 946388, 799848, 1020664, 499218, 344639, 644656, 472569, 90796, 801243, 663994, 987922, 831870, 838605, 489902, 1018298, 166298, 120163, 460639, 494943, 265344, 17878, 1022621, 166331, 714631, 568218, 622584, 924196, 411293, 383599, 1033339, 206044, 508852, 962959, 649376, 639056, 28657, 745285, 568452, 495766, 1026269, 372441, 335745, 707998, 488905, 804282, 188443, 889177, 220796, 722973, 378052, 977813, 435481, 764243, 846015, 973459, 443374, 320434, 335348, 541544, 107175, 967819, 411626, 1001848, 419812, 550115, 360880, 779526, 53508, 420499, 843391, 806988, 132980, 365622, 303988, 755313, 449635, 494859, 923221, 593589, 131351, 849110, 751548, 306934, 303540, 802867, 751195, 933104, 411361, 98255, 468398, 185879, 104460, 389183, 811447, 600662, 868545, 371237, 74170, 999272, 174079, 207411, 25362, 951342, 839517, 22261, 404408, 201243, 865496, 949829, 958399, 910907, 593495, 892269, 133631, 199176, 255160, 913465, 609367, 987505, 871498, 989506, 292898, 810712, 386648, 454747, 360152, 597217, 543543, 1002855, 530787, 780823, 291305, 715585, 290807, 240007, 366439, 296068, 335162, 589100, 1011129, 625965, 662656, 861092, 434590, 288662, 18056, 642163, 306099, 81599, 975550, 1014079, 340643, 494027, 566534, 115292, 500233, 788516, 869979, 339543, 406830, 787803, 13940, 689689, 480839, 19523, 166600, 746338, 1036108, 435926, 851435, 157098, 429216, 423367, 780003, 433971, 748379, 45344, 230207, 627930, 662671, 187362, 294701, 818652, 600717, 820988, 204423, 286905, 366797, 137546, 872936, 85926, 103697, 48349, 935665, 292487, 580848, 273926, 469739, 177963, 889097, 6787, 776823, 1012562, 293074, 866197, 268178, 97162, 412906, 272644, 596549, 781325, 933334, 118092, 722189, 980440, 467206, 423657, 906825, 498349, 265370, 580641, 226367, 738868, 132460, 532069, 654013, 726280, 671348, 179502, 294641, 398561, 121936, 777702, 988790, 609942, 773501, 354659, 192937, 477047, 51199, 642416, 710339, 560259, 915794, 181368, 587926, 440431, 637461, 369473, 391206, 629159, 147475, 9052, 800619, 656063, 369615, 589363, 273991, 319141, 264002, 762934, 108865, 167282, 571966, 836621, 997166, 277104, 327091, 375030, 343691, 652575, 591523, 860549, 941865, 783961, 560821, 939577, 62656, 24257, 396497, 415191, 90358, 745756, 180070, 48932, 16226, 808600, 759165, 838050, 497824, 1002506, 285071, 366783, 74136, 103607, 975718, 736662, 227558, 199893, 239313, 41458, 1022801, 388267, 74300, 698076, 346157, 993422, 229518, 770597, 996662, 71018, 666346, 219095, 287017, 874077, 62156, 1022959, 213891, 746699, 742840, 322720, 454259, 819870, 925702, 260706, 667794, 250811, 350669, 811153, 307389, 287691, 366803, 906391, 609313, 297922, 129094, 119879, 64325, 166942, 960349, 546315, 59654, 222390, 80960, 603012, 535661, 606483, 385089, 216948, 501009, 891563, 347634, 414818, 922610, 347871, 153254, 373703, 415017, 637267, 84127, 262208, 350756, 18530, 119035, 246622, 215891, 905239, 434927, 35025, 959342, 435340, 867283, 291965, 144901, 365713, 716153, 45098, 896009, 14766, 277531, 184422, 476982, 201797, 556377, 836502, 458181, 486998, 621964, 44379, 309462, 628535, 139544, 429082, 558112, 91449, 198854, 873404, 870627, 307843, 1008982, 839957, 680142, 108233, 864786};





/*************************************************
* Name:        montgomery_reduce
* 
* Description: Montgomery reduction; given a int64_t integer a(>=0), computes
*              int32_t integer congruent to a * R^(-1) mod q, 
*              where R=2^32 (see value of rlog)
*
* Arguments:   - int64_t a: input nonnegative integer to be reduced; has to be in {0,...,4612759138554621952}
*              
* Returns:     unsigned integer in {0,...,q-1} congruent to a * R^-1 modulo q.
**************************************************/
int32_t montgomery_reduce(int64_t a)
{
  int64_t u;

  u = (a * qinv);
  u = u & 0xFFFFFFFF;  // u = a * qinv mod 2^(32), u in {0,...,2^32-1}
  u = u * Q; 
  u = a + u; 
  // upperbound of a: 2^(63)- 1 - (2^(32)-1)q=4612759138554621952 \approx 62.000
  u = (u >> rlog);
  
  //u = (u  % Q+Q)%Q;
  u = u - Q; // {0,2q-1} to {0,q-1}
  u = u + (((int32_t)u >> 31) & Q);
  return (int32_t)u;
}

int32_t barrett_reduce(int32_t a)
{
  int32_t u;

  u = a >> 20;
  u = u * Q;
  a = a - u;
  a = a - Q; // {0,2q-1} to {0,q-1}
  a = a + ((a >> 31) & Q);
  return a;
}



void poly_ntt_o(int32_t *p)
{
	int level, start, j, k, shift;
	int32_t zeta, t;

	k = 1;
	for (level = 9; level >= 0; level--)
	{ 
		shift = 1 << level;
		for (start = 0; start < N; start = j + shift)
		{
			zeta = zetas[k++];
			for (j = start; j < start + shift; ++j)
			{
				t = montgomery_reduce((int64_t)zeta * (p[j + shift]+Q) );

				//p[j + shift] = (p[j] + 2*Q - t) % Q;
				//p[j] = (Q + p[j] + t) % Q;
				p[j + shift] = barrett_reduce(p[j] + 2*Q - t) ;
				p[j] = barrett_reduce(Q + p[j] + t);				
			}
		}
	}
}

void poly_invntt_o(int32_t * a)
{
	int start, j, jTwiddle, level;
	int32_t temp, W;
	int64_t t;

	for (level = 0; level < 10; level++)
	{
		for (start = 0; start < (1 << level); start++)
		{
			jTwiddle = 0;
			for (j = start; j < N - 1; j += 2 * (1 << level))
			{
				W = omegas_inv_bitrev_montgomery[jTwiddle++];
				temp = a[j];
				//a[j] = ((Q<<1) + temp + a[j + (1 << level)]) % Q; 
				a[j] = barrett_reduce((Q<<1) + temp + a[j + (1 << level)]); 

				t = ((int64_t)W * ((temp + (Q<<1) - a[j + (1 << level)])));

				a[j + (1 << level)] = montgomery_reduce(t);
			}
		}
	}

	for (j = 0; j < N; j++)
		a[j] = montgomery_reduce((int64_t)a[j] * psis_inv_montgomery[j]);
}



void poly_pointwise_o(int32_t * c, int32_t * a, int32_t * b)
{
	 int i;
	int32_t temp;
	for (i = 0; i < N; i++) {
		temp = montgomery_reduce((int64_t)119749 * a[i]);
		c[i] = montgomery_reduce((int64_t)temp*b[i]);
		//c[i] = (a[i] * b[i]) % Q;
		//2 ^ 64 mod  1038337 = 119749
	}

}


